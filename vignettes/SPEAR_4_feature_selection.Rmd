---
title: "SPEAR: Feature Selection"
author: "Jeremy Gygi"
date: "05/03/21"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{SPEAR_4-feature_selection}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

### This vignette will walk through feature selection using SPEAR

##### Installing SPEAR:

Follow installation instructions in README (located [here](https://github.com/jgygi/SPEAR))

##### Required Libraries:

```{r message = FALSE, warning = FALSE}
library(SPEAR)
```

##### Loading a SPEAR object:

After running SPEAR, you will have saved a SPEARobject (see vignette 2: Running SPEAR).

```{r}
SPEARobj <- readRDS("SPEAR_vignette_object_categorical.rds")
```

##### Choosing a SPEAR model:

See vignette 3: Downstream Analysis for more information on choosing a SPEARmodel. For this vignette, we will choose the SPEAR model using the default parameters (highest weight within one standard deviation of the lowest overall mean cv error). In this scenario, that ends up being $w = 2$:

```{r}
SPEARmodel <- SPEAR::get_SPEAR_model(SPEARobj)
```

##### Choosing a factor (or factors) of interest

See vignette 3: Downstream Analysis for information on how to analyze the individual factors generated by SPEAR.

For the purposes of this vignette, we will look at which factors are pertinent to prediction of the categorical response. We will add a custom `groups` parameter to the `SPEAR.plot_factor_scores` function:

```{r fig.width = 9}
# Below converts the categorical data from one-hot encoded into their labels (the column names):
custom.groups <- colnames(SPEARmodel$data$Y)[apply(SPEARmodel$data$Y, 1, which.max)]
# Set the names of the custom.groups vector to be the samples they correspond to (can use rownames):
names(custom.groups) <- rownames(SPEARmodel$data$Y)

SPEAR::SPEAR.plot_factor_scores(SPEARmodel, groups = custom.groups)
```

It looks like Factor 1 is the most interesting for separating Basal, Her2 and LumA/LumB. We will look into the best features for Factor 1.

### Getting a feature table

##### Get ALL features

```{r}
# This function will return all features for the requested factors and omics that meet the thresholds set by the coefficient.cutoff and probability.cutoff parameters.
#      factors: which factors are being analyzed? Defaults to all factors, but examples include: 1, c(1, 2, 3), c(1, 4)
#      omics: which omics should features be returned for? Defaults to all omics, but can specify omics based on their names
#      coefficient.cutoff: sets the minimum absolute magnitude of contribution for a feature. Defaults to .01
#      probability.cutoff: sets the minimum posterior selection probability for a feature. Defaults to .5

# If you want ALL features for ALL omics for a specific factor, set the cutoff parameters to 0:
feature.table.all <- SPEAR::SPEAR.get_feature_table(SPEARmodel, factors = 1, coefficient.cutoff = 0, probability.cutoff = 0)
head(feature.table.all)
```




